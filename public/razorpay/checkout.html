<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Razorpay Checkout</title>
</head>
<body>
  <h2 style="text-align:center;">Razorpay Checkout Loading...</h2>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    const query = new URLSearchParams(window.location.search);
    const orderId = query.get("order_id");
    const amount = query.get("amount");
    const key = query.get("key");
    const userName = query.get("name") || "User";

    if (!orderId || !amount || !key) {
      document.body.innerHTML = "<h3 style='color:red;text-align:center;'>Missing payment details</h3>";
    } else {
      const options = {
        key,
        amount,
        currency: "INR",
        name: "Horse Racing Game",
        description: "Wallet Deposit",
        order_id: orderId,
        handler: function (response) {
          fetch("/razorpay/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(response)
          })
          .then(res => res.json())
          .then(data => {
            if (data.success){
              if (window.Unity) {
                Unity.call("success");
              } else {
                alert("✅ Payment successful! Wallet updated.");
              }
            } else {
              if (window.Unity) {
                Unity.call("failure");
              } else {
                alert("❌ Payment failed.");
              }
            }
          })
          .catch(err => {
              console.log(err);
              if (window.Unity) {
                Unity.call("failure");
              } else {
                alert("❌ Verification failed");
              }
          });
        },
        prefill: {
          name: userName
        },
        theme: { color: "#3399cc" }
      };
      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>
</body>
</html>
